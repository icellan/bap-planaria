"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.watchBAPTransactions=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_reconnectingEventsource=_interopRequireDefault(require("./lib/reconnecting-eventsource")),_config=require("./config"),_bap=require("./bap.js"),watchBAPTransactions=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(){var b,c,d,e;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b={q:{find:{"out.s2":_config.BAP_BITCOM_ADDRESS}}},c=Buffer.from(JSON.stringify(b)).toString("base64"),d="https://txo.bitsocket.network/s/".concat(c),console.log("starting socket listener on",d),e=new _reconnectingEventsource["default"](d),e.onmessage=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b){var c;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:c=JSON.parse(b.data).data,c.forEach(function(a){(0,_bap.processBlockEvents)(a)});case 2:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),a.next=8,(0,_bap.indexBAPTransactions)();case 8:setInterval((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,_bap.indexBAPTransactions)();case 2:case"end":return a.stop();}},a)})),300000);case 9:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}();exports.watchBAPTransactions=watchBAPTransactions;