"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.watchBAPTransactions=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_reconnectingEventsource=_interopRequireDefault(require("./lib/reconnecting-eventsource")),_config=require("./config"),_bap=require("./bap.js"),watchBAPTransactions=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(){var b,c,d,e,f,g=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=!!(0<g.length&&void 0!==g[0])&&g[0],b=b||{"out.s2":_config.BAP_BITCOM_ADDRESS},c={q:{find:b}},d=Buffer.from(JSON.stringify(c)).toString("base64"),e="https://txo.bitsocket.network/s/".concat(d),console.log("starting socket listener on",e),f=new _reconnectingEventsource["default"](e),f.onmessage=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b){var c;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:c=JSON.parse(b.data).data,c.forEach(function(a){(0,_bap.processBlockEvents)(a)});case 2:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),a.next=10,(0,_bap.indexBAPTransactions)();case 10:setInterval((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,_bap.indexBAPTransactions)();case 2:case"end":return a.stop();}},a)})),300000);case 11:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}();exports.watchBAPTransactions=watchBAPTransactions;