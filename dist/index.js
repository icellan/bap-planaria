"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_yargs=_interopRequireDefault(require("yargs")),_yargs2=require("yargs/yargs"),_get=require("./get"),_bap=require("./bap"),_watch=require("./watch"),_config=require("./config"),options=(0,_yargs["default"])((0,_yargs2.hideBin)(process.argv)).usage("Usage: -a <action>").option("a",{alias:"action",describe:"Action (run (default), watch, get)",type:"string"}).option("t",{alias:"txId",describe:"Tx Id to get from bitbus - use together with -g option",type:"string"}).option("q",{alias:"query",describe:"JSON strinigifed query to get from bitbus - use together with -g option",type:"string"}).option("p",{alias:"parser",describe:"type of parser (bob or txo)",type:"string"}).argv;(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(){var b,c;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("get"!==options.action){a.next=15;break}return b={q:{find:{"out.s2":_config.BAP_BITCOM_ADDRESS},sort:{"blk.i":1},project:{blk:1,"tx.h":1,out:1,in:1},limit:10}},options.txId?b.q.find={"tx.h":options.txId}:options.query?b.q.find=JSON.parse(options.query):(console.error("Must pass either -t <txID> or -q <query> when using -a get"),process.exit(-1)),console.log(b),c=options.parser||"txo",a.t0=console,a.t1=JSON,a.next=9,(0,_get.getBitbusBlockEvents)(b,c);case 9:a.t2=a.sent,a.t3=a.t1.stringify.call(a.t1,a.t2),a.t0.log.call(a.t0,a.t3),process.exit(),a.next=26;break;case 15:if("watch"!==options.action){a.next=21;break}return console.log("Running continuous watch"),a.next=19,(0,_watch.watchBAPTransactions)();case 19:a.next=26;break;case 21:return console.log("Running once"),a.next=24,(0,_bap.indexBAPTransactions)();case 24:console.log("Done"),process.exit();case 26:case"end":return a.stop();}},a)}))()["catch"](function(a){console.error(a)});